<!DOCTYPE html>
<html>
<head>
    <title>SignalR Game</title>
    <style type="text/css">
        .container {
            background-color: #000000;
            border: thick solid #808080;
            width: 500px;
            height: 500px;
            padding: 20px;
            margin: 20px;
        }
        .player {
            background-color: #FFFFFF;
            position:absolute;
            top: 250px;
            left: 250px;
            min-width: 5px;
            min-height: 5px;
            max-width: 5px;
            max-height: 5px;
        }
    </style>
</head>
<body>
    <div id="gameSpace" class="container">
        <div id="player" class="player"></div>
        <div id="player2" class="player"></div>
    </div>
    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="scripts/jquery-1.10.2.min.js"></script>
    <!--Reference the SignalR library and autogenerated SignalR hub script. -->
    <script src="scripts/jquery.signalR-2.1.2.min.js"></script>
    <script src="signalr/hubs"></script>

    <!--Game specific scripts.-->
    <script src="scripts/modules/player.js"></script>
    
    <script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub.
            var gameHub = $.connection.gameHub;            

            // Get the player. TODO: game class.
            var player = new Player($('#player'), 5, gameHub);
            var secondPlayer = new Player($('#player2'), 5, gameHub);

            // Create a function that the hub can call to move other players.
            gameHub.client.moved = function (clientId, locationJson) {
                var location = JSON.parse(locationJson);
                secondPlayer.moveTo(location.left, location.top);
            };

            // Add players when they join.
            gameHub.client.joined = function (clientId, message) {
            };            

            // Get the user name and store it to prepend to messages.
            //$('#displayname').val(prompt('Enter your name to join a game:', ''));

            // Start the connection.
            $.connection.hub.start().done(function () {
                $(document).keypress(function (event) {
                    var key = String.fromCharCode(event.which).toUpperCase();

                    switch (key) {
                        case 'A':
                            player.move(-player.width, 0);
                            break;
                        case 'D':
                            player.move(player.width, 0);
                            break;
                        case 'W':
                            player.move(0, -player.width);
                            break;
                        case 'S':
                            player.move(0, player.width)
                            break;
                    }

                    return true;
                });
                
                gameHub.server.join('nick');
            });
        });
    </script>
</body>
</html>